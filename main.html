<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Wordsearch by Nika Shum</title>
  <style>
    :root {
      --cell-bg: #222;
      --cell-color: #fff;
      --cell-glow: 0 0 10px #00f;
      --correct-bg: #0f0;
      --correct-color: #000;
      --error-bg: #f00;
    }

    body.theme-light {
      --cell-bg: var(--cellBg, #ffffff);
      --cell-color: var(--textColor, #000000);
      --cell-glow: 0 0 8px var(--glow-color, #ff00ff);
    }

    body.theme-dark {
      --cell-bg: var(--cellBg, #000000);
      --cell-color: var(--textColor, #00e5e5);
      --cell-glow: 0 0 12px var(--glow-color, #00e5e5);
    }

    body.theme-rainbow {
      --cell-bg: var(--cellBg, #fff3dc);
      --cell-color: var(--textColor, #000000);
      --cell-glow: none;
    }

    body {
      background: transparent;
      color: var(--cell-color);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: sans-serif;
    }

    #container {
      display: flex;
      flex-direction: row;
      gap: 20px;
    }

    #game {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #grid {
      display: grid;
      gap: 4px;
    }

    .cell {
      width: 44px;
      height: 44px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: var(--cell-bg);
      border-radius: 8px;
      font-size: 20px;
      color: var(--cell-color);
      cursor: pointer;
      transition: 0.2s;
      user-select: none;
      box-shadow: var(--cell-glow);
    }

    .cell.selected {
      background: rgba(200, 200, 200, 0.2);
    }

    .cell.correct {
      background: var(--correct-bg);
      color: var(--correct-color);
    }

    .cell.error {
      background: var(--error-bg);
      animation: shake 0.3s;
    }

    @keyframes shake {
      0%, 100% { transform: translate(0); }
      20% { transform: translate(-2px, 1px); }
      40% { transform: translate(2px, -1px); }
      60% { transform: translate(-1px, 2px); }
      80% { transform: translate(1px, -2px); }
    }

    #wordsList {
      list-style: none;
      padding: 0;
      font-size: 18px;
      max-width: 180px;
    }

    #wordsList li.found {
      text-decoration: line-through;
      color: #aaa;
    }

    #messageBox {
      margin-top: 10px;
      font-size: 20px;
      color: #0f0;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="game">
      <div id="grid"></div>
      <div id="messageBox"></div>
    </div>
    <ul id="wordsList"></ul>
  </div>

  <script>
    const url = new URL(window.location.href);
    const params = url.searchParams;

    const words = (params.get("words") || "МАМА,ПАПА,СЫР").toUpperCase().split(",");
    const winText = decodeURIComponent(params.get("winText") || "Все слова найдены!");
    const theme = params.get("theme") || "light";
    const font = decodeURIComponent(params.get("font") || "Comic Neue");
    const glowColor = params.get("glowColor") || "#00ffff";
    const cellBg = params.get("cellBg");
    const textColor = params.get("textColor");
    const sound = params.get("sound") !== "0";
    const lang = params.get("lang") || "ru";
    const rows = parseInt(params.get("rows")) || 10;
    const cols = parseInt(params.get("cols")) || 10;

    document.body.classList.add("theme-" + theme);
    document.body.style.setProperty('--glow-color', glowColor);
    if (cellBg) document.body.style.setProperty('--cellBg', cellBg);
    if (textColor) document.body.style.setProperty('--textColor', textColor);
    document.body.style.fontFamily = `'${font}', sans-serif`;

    const alphabetByLang = {
      ru: "АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ",
      en: "ABCDEFGHIJKLMNOPQRSTUVWXYZ",
      fr: "ABCDEFGHIJKLMNOPQRSTUVWXYZ",
      de: "ABCDEFGHIJKLMNOPQRSTUVWXYZÄÖÜß",
      es: "ABCDEFGHIJKLMNÑOPQRSTUVWXYZ",
      it: "ABCDEFGHIJKLMNOPQRSTUVWXYZ",
      zh: "的一是在不了有和人这中大为上个国我以要他",
      ja: "アイウエオカキクケコサシスセソタチツテトナニヌネノ"
    };
    const letters = alphabetByLang[lang] || alphabetByLang["en"];

    const grid = [];
    const cells = [];

    const gridElement = document.getElementById("grid");
    const messageBox = document.getElementById("messageBox");
    const wordsList = document.getElementById("wordsList");

    gridElement.style.gridTemplateColumns = `repeat(${cols}, 44px)`;

    for (let r = 0; r < rows; r++) {
      const row = [];
      const rowEls = [];
      for (let c = 0; c < cols; c++) {
        row.push('');
        const div = document.createElement("div");
        div.className = "cell";
        div.dataset.row = r;
        div.dataset.col = c;
        rowEls.push(div);
        gridElement.appendChild(div);
      }
      grid.push(row);
      cells.push(rowEls);
    }

    const directions = [
      [0, 1], [1, 0], [1, 1], [-1, 1],
      [0, -1], [-1, 0], [-1, -1], [1, -1]
    ];

    function placeWord(word) {
      for (let attempt = 0; attempt < 100; attempt++) {
        const dir = directions[Math.floor(Math.random() * directions.length)];
        const startRow = Math.floor(Math.random() * rows);
        const startCol = Math.floor(Math.random() * cols);
        let r = startRow, c = startCol;
        let valid = true;

        for (const ch of word) {
          if (r < 0 || c < 0 || r >= rows || c >= cols || (grid[r][c] && grid[r][c] !== ch)) {
            valid = false;
            break;
          }
          r += dir[0];
          c += dir[1];
        }

        if (valid) {
          r = startRow;
          c = startCol;
          for (const ch of word) {
            grid[r][c] = ch;
            r += dir[0];
            c += dir[1];
          }
          return;
        }
      }
    }

    words.forEach(placeWord);

    for (let r = 0; r < rows; r++) {
      for (let c = 0; c < cols; c++) {
        if (!grid[r][c]) {
          const ch = letters[Math.floor(Math.random() * letters.length)];
          grid[r][c] = ch;
        }
        cells[r][c].textContent = grid[r][c];
      }
    }

    const selected = [];
    let found = 0;

    function resetSelection() {
      selected.forEach(cell => cell.classList.remove("selected", "error"));
      selected.length = 0;
    }

    function checkWord() {
      const word = selected.map(c => c.textContent).join('');
      if (words.includes(word)) {
        selected.forEach(c => c.classList.add("correct"));
        const li = [...wordsList.children].find(li => li.textContent === word);
        if (li) li.classList.add("found");
        found++;
        if (found === words.length) {
          messageBox.textContent = winText;
        }
      } else {
        selected.forEach(c => c.classList.add("error"));
      }
      setTimeout(resetSelection, 500);
    }

    gridElement.addEventListener("click", e => {
      const cell = e.target.closest(".cell");
      if (!cell || cell.classList.contains("correct")) return;
      const row = parseInt(cell.dataset.row);
      const col = parseInt(cell.dataset.col);
      if (selected.length > 0) {
        const last = selected[selected.length - 1];
        const dRow = Math.abs(row - parseInt(last.dataset.row));
        const dCol = Math.abs(col - parseInt(last.dataset.col));
        if (!(dRow <= 1 && dCol <= 1)) return;
      }
      cell.classList.add("selected");
      selected.push(cell);
      if (selected.length > 1) checkWord();
    });

    words.forEach(word => {
      const li = document.createElement("li");
      li.textContent = word;
      wordsList.appendChild(li);
    });
  </script>
</body>
</html>
