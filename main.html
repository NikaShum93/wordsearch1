<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Wordsearch by Nika Shum</title>
  <!-- Подключаем все нужные шрифты -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Comic+Neue&family=Orbitron&family=Baloo+2&family=Comfortaa&family=Ruslan+Display&family=Roboto+Slab&family=Michroma&family=Nunito&family=Fredoka&family=M+PLUS+Rounded+1c&family=Open+Sans&family=Merriweather&family=Noto+Sans+SC&family=ZCOOL+KuaiLe&family=Ma+Shan+Zheng&family=Noto+Sans+JP&family=Yomogi&family=Nico+Moji&family=DotGothic16&display=swap" rel="stylesheet">

  <style>
    :root {
      --main-color: #00ffff;
      --font-family: 'Orbitron', sans-serif;
      --cell-bg: rgba(0, 0, 0, 0.5);
      --border-color: #00ffff;
      --text-color: #00ffff;
      --glow-color: #00ffff;
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      background: transparent;
      font-family: var(--font-family);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #grid {
      display: grid;
      gap: 6px;
    }

    .cell {
      width: 42px;
      height: 42px;
      border-radius: 10px;
      background: var(--cell-bg);
      border: 2px solid var(--border-color);
      color: var(--text-color);
      font-family: var(--font-family);
      font-weight: bold;
      font-size: 22px;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
      transition: 0.2s;
    }

    .cell.glow {
      box-shadow: 0 0 12px var(--glow-color), inset 0 0 8px var(--glow-color);
    }

    .cell.rainbow {
      animation: rainbowGlow 2.5s linear infinite;
    }

    @keyframes rainbowGlow {
      0%   { box-shadow: 0 0 12px #ff0088; color: #ff0088; }
      25%  { box-shadow: 0 0 12px #00ffff; color: #00ffff; }
      50%  { box-shadow: 0 0 12px #00ff55; color: #00ff55; }
      75%  { box-shadow: 0 0 12px #ffaa00; color: #ffaa00; }
      100% { box-shadow: 0 0 12px #ff0088; color: #ff0088; }
    }
  </style>
</head>
<body>
  <div id="grid"></div>
  <script>
    const params = new URLSearchParams(window.location.search);

    const gridSize = Math.max(5, Math.min(15, parseInt(params.get("gridSize")) || 10));
    const words = (params.get("words") || "")
      .split(",")
      .map(w => w.trim())
      .filter(Boolean);

    const winText = decodeURIComponent(params.get("winText") || "Ты нашёл все слова!");
    const caseType = params.get("case") || "uppercase";
    const alphabet = params.get("alphabet") || "latin";
    const fontStyle = params.get("fontStyle") || "classic";
    const cellColor = params.get("cellColor") || "rgba(0,0,0,0.5)";
    const borderColor = params.get("cellBorder") || "#00ffff";
    const textColor = params.get("textColor") || borderColor;
    const glowColor = params.get("glowColor") || "#00ffff";
    const glowType = params.get("glowType") || "none";

    const alphabets = {
      latin: "ABCDEFGHIJKLMNOPQRSTUVWXYZ",
      cyrillic: "АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ",
      french: "ABCDEFGHIJKLMNOPQRSTUVWXYZ",
      german: "ABCDEFGHIJKLMNOPQRSTUVWXYZÄÖÜß",
      spanish: "ABCDEFGHIJKLMNÑOPQRSTUVWXYZ",
      pinyin: "ABCDEFGHIJKLMNOPQRSTUVWXYZ",
      hiragana: "あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわをん"
    };
    const fontPresets = {
      latin: {
        classic: "Roboto",
        comic: "Comic Neue",
        cute: "Baloo 2",
        tech: "Orbitron"
      },
      cyrillic: {
        classic: "Roboto Slab",
        comic: "Ruslan Display",
        cute: "Comfortaa",
        tech: "Michroma"
      },
      french: {
        classic: "Nunito",
        comic: "Comic Neue",
        cute: "Baloo 2",
        tech: "Orbitron"
      },
      german: {
        classic: "Open Sans",
        comic: "Fredoka",
        cute: "M PLUS Rounded 1c",
        tech: "Orbitron"
      },
      spanish: {
        classic: "Merriweather",
        comic: "Comic Neue",
        cute: "Baloo 2",
        tech: "Orbitron"
      },
      pinyin: {
        classic: "Noto Sans SC",
        comic: "ZCOOL KuaiLe",
        cute: "Ma Shan Zheng",
        tech: "Orbitron"
      },
      hiragana: {
        classic: "Noto Sans JP",
        comic: "Yomogi",
        cute: "Nico Moji",
        tech: "DotGothic16"
      }
    };

    const alphabetSet = alphabets[alphabet] || alphabets.latin;
    const selectedFont = (fontPresets[alphabet] || fontPresets.latin)[fontStyle] || "Orbitron";

    // Устанавливаем параметры в CSS
    document.documentElement.style.setProperty("--font-family", `'${selectedFont}', sans-serif`);
    document.documentElement.style.setProperty("--cell-bg", cellColor);
    document.documentElement.style.setProperty("--border-color", borderColor);
    document.documentElement.style.setProperty("--text-color", textColor);
    document.documentElement.style.setProperty("--glow-color", glowColor);
  const level = params.get("level") || "medium";
  const directions = {
    easy: [[1, 0], [0, 1]],
    medium: [[1, 0], [0, 1], [1, 1], [-1, 1]],
    hard: [[1, 0], [0, 1], [1, 1], [-1, 1], [1, -1], [0, -1], [-1, 0], [-1, -1]]
  };

  const gridArray = Array.from({ length: gridSize }, () =>
    Array(gridSize).fill("")
  );

  // Размещение слов
  for (const raw of words) {
    const word = [...raw.toUpperCase()].filter(l => alphabetSet.includes(l));
    if (word.length > gridSize) {
      console.warn(`⚠️ Слово "${raw}" слишком длинное для сетки ${gridSize}x${gridSize}`);
      continue;
    }

    let placed = false;
    for (let attempt = 0; attempt < 100; attempt++) {
      const [dx, dy] = directions[level][Math.floor(Math.random() * directions[level].length)];
      const x = Math.floor(Math.random() * gridSize);
      const y = Math.floor(Math.random() * gridSize);

      let fits = true;
      for (let i = 0; i < word.length; i++) {
        const nx = x + dx * i;
        const ny = y + dy * i;
        if (nx < 0 || ny < 0 || nx >= gridSize || ny >= gridSize) {
          fits = false;
          break;
        }
        if (gridArray[ny][nx] && gridArray[ny][nx] !== word[i]) {
          fits = false;
          break;
        }
      }

      if (fits) {
        for (let i = 0; i < word.length; i++) {
          const nx = x + dx * i;
          const ny = y + dy * i;
          gridArray[ny][nx] = word[i];
        }
        placed = true;
        break;
      }
    }

    if (!placed) {
      console.warn(`⚠️ Не удалось вставить слово: ${raw}`);
    }
  }

  // Заполнение оставшихся клеток случайными буквами
  for (let y = 0; y < gridSize; y++) {
    for (let x = 0; x < gridSize; x++) {
      if (!gridArray[y][x]) {
        const rand = alphabetSet[Math.floor(Math.random() * alphabetSet.length)];
        gridArray[y][x] = caseType === "lowercase" ? rand.toLowerCase() : rand.toUpperCase();
      }
    }
  }

  // Отрисовка грида
  const grid = document.getElementById("grid");
  grid.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;

  for (let y = 0; y < gridSize; y++) {
    for (let x = 0; x < gridSize; x++) {
      const div = document.createElement("div");
      div.className = "cell";
      div.textContent = gridArray[y][x];

      if (glowType === "neon") div.classList.add("glow");
      if (glowType === "rainbow") div.classList.add("rainbow");

      grid.appendChild(div);
    }
  }
  let selectedCells = [];
  let foundWords = [];

  function clearSelection(error = false) {
    selectedCells.forEach(cell => {
      cell.classList.remove("selected");
      if (error) {
        cell.style.background = "#e74c3c";
        cell.style.color = "#fff";
        setTimeout(() => {
          cell.style.background = "";
          cell.style.color = "";
        }, 300);
      }
    });
    selectedCells = [];
  }

  function getCellCoords(cell) {
    const index = Array.from(grid.children).indexOf(cell);
    return {
      x: index % gridSize,
      y: Math.floor(index / gridSize)
    };
  }

  function checkDirection(cells) {
    if (cells.length < 2) return false;
    const { x: x0, y: y0 } = getCellCoords(cells[0]);
    const { x: x1, y: y1 } = getCellCoords(cells[1]);
    const dx = x1 - x0;
    const dy = y1 - y0;
    for (let i = 1; i < cells.length; i++) {
      const { x, y } = getCellCoords(cells[i]);
      if (x !== x0 + dx * i || y !== y0 + dy * i) return false;
    }
    return true;
  }

  function handleClick(e) {
    const cell = e.target;
    if (!cell.classList.contains("cell")) return;
    if (selectedCells.includes(cell)) return;

    cell.classList.add("selected");
    selectedCells.push(cell);

    const selectedWord = selectedCells.map(c => c.textContent).join("");
    const normalizedWord = selectedWord.toUpperCase();

    const matches = words.some(
      word => word.toUpperCase() === normalizedWord
    );

    const isDirectionOk = checkDirection(selectedCells);

    if (matches && isDirectionOk) {
      selectedCells.forEach(cell => {
        cell.classList.add("glow");
        cell.style.background = "#38ff8e";
        cell.style.color = "#000";
      });
      foundWords.push(normalizedWord);
      selectedCells = [];

      if (foundWords.length === words.length) {
        setTimeout(() => {
          const message = document.createElement("div");
          message.textContent = winText;
          message.style.position = "fixed";
          message.style.top = "50%";
          message.style.left = "50%";
          message.style.transform = "translate(-50%, -50%)";
          message.style.padding = "20px 30px";
          message.style.background = "rgba(0,0,0,0.8)";
          message.style.border = "2px solid var(--main-color)";
          message.style.borderRadius = "16px";
          message.style.fontSize = "24px";
          message.style.color = "var(--main-color)";
          message.style.fontFamily = "var(--font-family)";
          message.style.boxShadow = "0 0 20px var(--main-color)";
          document.body.appendChild(message);
        }, 500);
      }
    } else {
      const isMistake = !words.some(w =>
        w.toUpperCase().startsWith(normalizedWord)
      );
      if (isMistake || selectedCells.length > gridSize) {
        clearSelection(true);
      }
    }
  }

  // Включаем обработчик
  grid.addEventListener("click", handleClick);
</script>
</body>
</html>

