<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Wordsearch by Nika Shum</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100%;
      height: 100%;
      background: #111;
      font-family: sans-serif;
    }
    #container {
      display: flex;
      flex-direction: row;
      width: 100%;
      height: 100%;
    }
    #grid {
      display: grid;
      place-content: center;
      margin: auto;
      gap: 2px;
    }
    .cell {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      user-select: none;
      font-weight: bold;
      font-size: 18px;
      box-shadow: 0 0 4px rgba(0,0,0,0.5);
      transition: transform 0.1s ease;
    }
    .cell.selected {
      background: gold !important;
      transform: scale(1.1);
    }
    .cell.correct {
      background: limegreen !important;
    }
    #wordList {
      color: white;
      font-size: 16px;
      padding: 10px;
    }
    #wordList li {
      margin-bottom: 4px;
    }
    #finalText {
      display: none;
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #00ffff;
      font-size: 32px;
      font-family: 'Comic Neue', sans-serif;
      text-align: center;
      animation: fadein 1s ease forwards;
    }
    @keyframes fadein {
      from { opacity: 0; transform: translate(-50%, -60%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }
    canvas.sparkle {
      position: absolute;
      pointer-events: none;
      z-index: 999;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="grid"></div>
    <ul id="wordList"></ul>
  </div>
  <div id="finalText"></div>
  <canvas id="sparkleCanvas" class="sparkle"></canvas>

  <audio id="popSound" src="https://nikashum93.github.io/pusyriki/sound.mp3"></audio>

  <script>
    const params = new URLSearchParams(window.location.search);
    const words = decodeURIComponent(params.get('words') || '').split(',').map(w => w.trim().toUpperCase());
    const winText = decodeURIComponent(params.get('winText') || 'Молодец!');
    const rows = +params.get('rows') || 10;
    const cols = +params.get('cols') || 10;
    const glowColor = params.get('glowColor') || '#00ffff';
    const cellBg = params.get('cellBg') || '#ffffff';
    const textColor = params.get('textColor') || '#000000';
    const theme = params.get('theme') || 'light';
    const font = decodeURIComponent(params.get('font') || 'sans-serif');
    const glossy = params.get('glossy') === '1';
    const sound = params.get('sound') === '1';

    const grid = document.getElementById('grid');
    const wordList = document.getElementById('wordList');
    const finalText = document.getElementById('finalText');
    const sparkleCanvas = document.getElementById('sparkleCanvas');
    const ctx = sparkleCanvas.getContext('2d');

    document.body.style.fontFamily = font;
    sparkleCanvas.width = window.innerWidth;
    sparkleCanvas.height = window.innerHeight;

    // Theme styles
    if (theme === 'dark') {
      document.body.style.background = '#0b0b0f';
    } else if (theme === 'rainbow') {
      document.body.style.background = 'linear-gradient(135deg, red, orange, yellow, green, blue, indigo, violet)';
      document.body.style.backgroundSize = '400% 400%';
      document.body.style.animation = 'rainbowMove 15s ease infinite';
    }

    const style = document.createElement('style');
    style.innerHTML = `
      .cell {
        background: ${cellBg};
        color: ${textColor};
        box-shadow: 0 0 6px ${glowColor};
      }
      @keyframes rainbowMove {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `;
    document.head.appendChild(style);

    const alphabet = 'АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ';
    const gridData = Array.from({ length: rows }, () => Array(cols).fill(''));

    // Fill grid with random letters
    for (let y = 0; y < rows; y++) {
      for (let x = 0; x < cols; x++) {
        gridData[y][x] = alphabet[Math.floor(Math.random() * alphabet.length)];
      }
    }

    // Display grid
    grid.style.gridTemplateColumns = `repeat(${cols}, 36px)`;
    grid.style.gridTemplateRows = `repeat(${rows}, 36px)`;
    for (let y = 0; y < rows; y++) {
      for (let x = 0; x < cols; x++) {
        const div = document.createElement('div');
        div.className = 'cell';
        div.dataset.row = y;
        div.dataset.col = x;
        div.textContent = gridData[y][x];
        grid.appendChild(div);
      }
    }

    // Add word list
    words.forEach(word => {
      const li = document.createElement('li');
      li.textContent = word;
      wordList.appendChild(li);
    });

    // Sparkle effect
    function sparkle(x, y) {
      if (!glossy) return;
      const particles = [];
      for (let i = 0; i < 20; i++) {
        particles.push({
          x, y,
          dx: (Math.random() - 0.5) * 4,
          dy: (Math.random() - 0.5) * 4,
          size: Math.random() * 2 + 1,
          alpha: 1
        });
      }
      const interval = setInterval(() => {
        ctx.clearRect(0, 0, sparkleCanvas.width, sparkleCanvas.height);
        particles.forEach(p => {
          p.x += p.dx;
          p.y += p.dy;
          p.alpha -= 0.02;
          ctx.fillStyle = `rgba(255,255,255,${p.alpha})`;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          ctx.fill();
        });
        if (particles.every(p => p.alpha <= 0)) clearInterval(interval);
      }, 16);
    }

    const selected = [];
    grid.addEventListener('click', e => {
      const cell = e.target.closest('.cell');
      if (!cell || cell.classList.contains('correct')) return;
      const { row, col } = cell.dataset;
      if (selected.length > 0) {
        const last = selected[selected.length - 1];
        const dRow = Math.abs(row - last.dataset.row);
        const dCol = Math.abs(col - last.dataset.col);
        if (!(dRow <= 1 && dCol <= 1)) return;
      }
      cell.classList.add('selected');
      selected.push(cell);
      if (sound) document.getElementById('popSound').play();
      if (glossy) sparkle(e.pageX, e.pageY);
      if (selected.length > 1) checkWord();
    });

    function checkWord() {
      const str = selected.map(c => c.textContent).join('');
      if (words.includes(str)) {
        selected.forEach(c => c.classList.add('correct'));
        wordList.querySelectorAll('li').forEach(li => {
          if (li.textContent === str) li.style.textDecoration = 'line-through';
        });
        const allCorrect = [...grid.querySelectorAll('.correct')].length >= words.join('').length;
        if (allCorrect) {
          finalText.textContent = winText;
          finalText.style.display = 'block';
        }
      }
      selected.forEach(c => c.classList.remove('selected'));
      selected.length = 0;
    }
  </script>
</body>
</html>
